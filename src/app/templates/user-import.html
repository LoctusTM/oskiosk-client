<navbar></navbar>

<div class="container-fluid">
    <h1 class="mt-2"> Import Users</h1>

    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header">Import from CSV file</div>
          <div class="card-body text-info">
              <p>Users can be imported from a CSV-formatted file, which can be generated by e.g. Libreoffice/Openoffice Calc or Microsoft Excel. The imported file has to be in a specific format, which is displayed below. After selecting a file, you will see a preview of the file contents. Please check this preview carefully! If everything looks as expected, you may start the import process by clicking the "Start Import" button. Please note that depending on the connection speed and the number of imported users this may take some time.</p>
              <p><b>Example CSV file:</b></p>
              <pre><code>
"Test 123",0,"tag_a tag_b","12345"
"Test 456",1,"tag_c","67890"
              </code></pre>
              <p><b>Format explanation:</b></p>
              <ul>
                  <li>Username (first column): The desired name of the user</li>
                  <li>Allow negative balance (second column): 0 = Prepaid user, 1 = Postpaid user</li>
                  <li>Tags (third column): Any tags that should be applied to the user. Multiple tags can be seperated with spaces.</li>
                  <li>Barcode (fourth column): The barcode which is assigned to this user. Please note that the barcode should always be a string value in order to avoid problems e.g. with leading zeroes.</li>
              </ul>
          </div>
          <div class="card-footer">
            <button class="btn btn-success mr-2" (click)="confirmImport()">Start Import</button>
            <button class="btn btn-warning" (click)="abortImport()">Abort Import</button>
            <input type="file" (change)="fileEventListener($event)">
          </div>
        </div>
        <div *ngIf="importableUsers.length > 0">
            <div class="progress mt-2">
                <div class="progress-bar" [style.width]="importProgress + '%'"></div>
            </div>
            <table class="table table-bordered mt-2">
                <thead>
                    <tr>
                        <th class="text-center w-25">User name</th>
                        <th class="text-center w-25">Prepaid / Postpaid</th>
                        <th class="text-center w-25">Tags</th>
                        <th class="text-center w-25">Barcode</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of importableUsers">
                        <td>
                            {{ item.name }}
                            <span *ngIf="item.import_success" class="badge badge-success">Import OK</span>
                            <span *ngIf="item.import_fail" class="badge badge-danger">Import Fail</span>
                        </td>
                        <td>
                            <span *ngIf="item.allow_negative_balance" class="badge badge-success">Negative balance allowed</span>
                            <span *ngIf="!item.allow_negative_balance" class="badge badge-danger">Negative balance not allowed</span>
                        </td>
                        <td>
                            <span *ngFor="let tag of item.tags" class="badge badge-secondary mr-1">{{ tag.name }}</span>
                        </td>
                        <td>{{ item.identifiers[0].code }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
      </div>
    </div>
</div>
